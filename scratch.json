  
  {
    "type": "Microsoft.Compute/virtualMachineScaleSets",
    "name": "node",
    "location": "[resourceGroup().location]",
    "apiVersion": "2017-03-30",
    "properties": {
      "overprovision": false,
      "upgradePolicy": {
        "mode": "Manual"
      },
      "virtualMachineProfile": {
        "storageProfile": {
          "osDisk": {
            "createOption": "FromImage"
          },
          "imageReference": {
            "publisher": "Canonical",
            "offer": "UbuntuServer",
            "sku": "16.04-LTS",
            "version": "latest"
          },
          "dataDisks": [
            {
              "lun": 0,
              "createOption": "Empty",
              "managedDisk": {
                "storageAccountType": "Premium_LRS"
              },
              "caching": "None",
              "diskSizeGB": "[parameters('diskSize')]"
            }
          ]
        },
        "osProfile": {
          "computerNamePrefix": "node",
          "adminUsername": "[parameters('adminUsername')]",
          "adminPassword": "[parameters('adminPassword')]"
        },
        "networkProfile": {
          "networkInterfaceConfigurations": [
            {
              "name": "nic",
              "properties": {
                "primary": true,
                "ipConfigurations": [
                  {
                    "name": "ipconfig",
                    "properties": {
                      "subnet": {
                        "id": "[concat(resourceId('Microsoft.Network/virtualNetworks/', 'vnet'), '/subnets/subnet')]"
                      },
                      "publicipaddressconfiguration": {
                        "name": "public",
                        "properties": {
                          "idleTimeoutInMinutes": 30,
                          "dnsSettings": {
                            "domainNameLabel": "[concat('node-', parameters('uniqueString'))]"
                          }
                        }
                      }
                    }
                  }
                ]
              }
            }
          ]
        },
        "extensionProfile": {
          "extensions": [
            {
              "name": "extension",
              "properties": {
                "publisher": "Microsoft.Azure.Extensions",
                "type": "CustomScript",
                "typeHandlerVersion": "2.0",
                "autoUpgradeMinorVersion": true,
                "settings": {
                  "fileUris": [
                    "[concat(parameters('extensionUrl'), 'node.sh')]"
                  ],
                  "commandToExecute": "[concat('bash node.sh ', parameters('adminUsername'), ' ', parameters('adminPassword'), ' ', parameters('uniqueString'), ' ', parameters('licenseKey'), ' ', resourceGroup().location)]"
                }
              }
            }
          ]
        }
      }
    }
  }